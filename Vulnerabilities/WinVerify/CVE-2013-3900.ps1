# More compatible way to detect OS architecture
$is64Bit = (Get-WmiObject Win32_OperatingSystem).OSArchitecture -eq "64-bit"

# Always create and set the 32-bit path
New-Item -Path "HKLM:\Software\Microsoft\Cryptography\Wintrust\Config" -Force | Out-Null
Set-ItemProperty -Path "HKLM:\Software\Microsoft\Cryptography\Wintrust\Config" -Name "EnableCertPaddingCheck" -Value "1" -Type String -Force

# Only create and set Wow6432Node if on 64-bit Windows
if ($is64Bit) {
    New-Item -Path "HKLM:\Software\Wow6432Node\Microsoft\Cryptography\Wintrust\Config" -Force | Out-Null
    Set-ItemProperty -Path "HKLM:\Software\Wow6432Node\Microsoft\Cryptography\Wintrust\Config" -Name "EnableCertPaddingCheck" -Value "1" -Type String -Force
}